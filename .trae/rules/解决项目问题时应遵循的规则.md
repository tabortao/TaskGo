# 解决项目问题时应遵循的规则（Rules）

这些规则旨在确保代码质量、安全性、性能和维护性。

### 1. 代码风格和一致性

- **后端 (Go)**：
  - 使用 `gofmt` 和 `goimports` 自动格式化代码，保持代码风格一致。
  - 遵循 Go 的官方代码风格指南（如 Effective Go）。
  - 使用有意义的变量和函数命名，采用驼峰式命名法。
- **前端 (JavaScript/HTML/CSS)**：
  - 使用 ES6+ 语法，避免使用 var，优先使用 const 和 let。
  - 使用 Prettier 或 ESLint 进行代码格式化，确保代码一致性。
  - 遵循语义化 HTML5 结构，使用 Tailwind CSS 的实用类名，避免自定义 CSS 除非必要。

### 2. 错误处理

- **后端**：
  - 始终处理错误，避免使用 panic，而是返回适当的 HTTP 错误响应（如 400、500 等）。
  - 在 Gin 中，使用中间件统一错误处理，返回 JSON 格式的错误信息。
- **前端**：
  - 使用 try-catch 处理异步操作（如 fetch API 调用），向用户显示友好的错误消息。
  - 验证用户输入在前端，但后端也必须进行验证。

### 3. 认证和授权

- **后端**：
  - 使用 golang-jwt 库生成和验证 JWT 令牌。令牌应包含过期时间（exp）和必要用户声明。
  - 保护路由使用 Gin 中间件，验证 JWT 令牌是否有效且未过期。
  - 使用 HTTPS 在生产环境传输 JWT，避免令牌泄露。
- **前端**：
  - 将 JWT 存储在 HttpOnly cookie 中或 localStorage（根据安全需求选择），但注意 XSS 风险。
  - 在每个 API 请求中携带 JWT（如 Authorization 头）。

### 4. 数据库操作

- **后端**：
  - 使用 GORM 时，启用预编译语句以防止 SQL 注入。
  - 合理定义模型结构体，使用 GORM 的标签（如`gorm:"index"`）优化数据库索引。
  - 使用数据库迁移（GORM 的 AutoMigrate 或手动迁移）来管理模式变更。
  - 避免使用全局数据库实例，而是通过依赖注入传递数据库连接。

### 5. API 设计

- **后端**：
  - 遵循 RESTful API 设计原则，使用 HTTP 方法（GET、POST、PUT、DELETE）对应 CRUD 操作。
  - 使用 Gin 的路由组（Group）组织 API 端点，例如`/api/v1/`。
  - 返回一致的 JSON 响应格式（如`{ "data": {}, "error": "" }`）。
- **前端**：
  - 使用 fetch API 或 Axios 与后端通信，处理响应和错误。
  - 将 API URL 配置为环境变量，便于不同环境部署。

### 6. 安全性

- **后端**：
  - 使用 Gin 的中间件设置 CORS，允许前端域名访问 API。
  - 验证和清理用户输入，防止跨站脚本（XSS）和 SQL 注入。
  - 避免在日志中记录敏感信息（如密码、JWT）。
- **前端**：
  - 避免在客户端代码中硬编码敏感信息（如 API 密钥）。
  - 使用 Tailwind CSS 的净化（purge）功能移除未使用的 CSS，减少攻击面。

### 7. 性能优化

- **后端**：
  - 使用 Gin 的中间件进行请求压缩（如 gzip）和缓存控制。
  - 优化数据库查询，使用 GORM 的 Preload 或 Joins 避免 N+1 查询问题。
  - 考虑使用 SQLite 连接池（虽然 SQLite 是嵌入式，但并发读写需谨慎）。
- **前端**：
  - 压缩和最小化 JavaScript 和 CSS 文件。
  - 使用浏览器缓存静态资源。

### 8. 容器化部署

- **Docker**：
  - 使用多阶段 Docker 构建，减少镜像大小（例如，从 Go 构建阶段到最终阶段）。
  - 在 Dockerfile 中设置非 root 用户运行容器，增强安全。
- **Docker Compose**：
  - 使用 docker-compose.yml 定义服务（后端、前端、数据库等），便于本地开发和生产部署。
  - 将环境变量存储在.env 文件中，并通过 Docker Compose 管理。

### 9. 测试和日志

- **后端**：
  - 编写单元测试和集成测试，使用 Go 的 testing 包和 Gin 的测试工具。
  - 使用结构化日志（如 logrus 或 zap）记录请求和错误信息。
- **前端**：
  - 考虑使用 Jest 进行 JavaScript 单元测试。
  - 使用 console.log 进行调试，但生产环境中移除或使用日志服务。

### 10. 版本控制和协作

- 使用 Git 进行版本控制，遵循类似 Git Flow 的分支策略（main、develop、feature 分支）。
- 提交信息应清晰描述更改内容，使用约定式提交（Conventional Commits）如果可能。
