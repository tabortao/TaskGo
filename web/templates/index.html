<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskGo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
    <link rel="manifest" href="/static/icons/site.webmanifest">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#64748b',
                        success: '#22c55e',
                        background: '#f8fafc',
                        surface: '#ffffff',
                        border: '#e2e8f0'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-background text-gray-800 antialiased">
    <!-- 登录/注册界面 -->
    <div id="auth-container" class="min-h-screen flex items-center justify-center bg-background p-4">
        <div class="w-full max-w-sm">
            <!-- 登录表单 -->
            <div id="login-view" class="bg-surface p-8 rounded-lg shadow-sm border border-border">
                <h2 class="text-2xl font-medium mb-6 text-center">Welcome to TaskGo</h2>
                <form id="login-form" class="space-y-4">
                    <div>
                        <input type="text" id="login-username" placeholder="Username" required 
                               class="w-full px-4 py-2 rounded-lg border border-border bg-background focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                    </div>
                    <div>
                        <input type="password" id="login-password" placeholder="Password" required 
                               class="w-full px-4 py-2 rounded-lg border border-border bg-background focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                    </div>
                    <button type="submit" 
                            class="w-full bg-primary text-white py-2 rounded-lg hover:bg-primary/90 transition-colors">
                        Sign In
                    </button>
                </form>
                <p class="mt-4 text-sm text-center text-secondary">
                    New to TaskGo? 
                    <a href="#" id="show-register" class="text-primary hover:underline">Create an account</a>
                </p>
            </div>

            <!-- 注册表单 -->
            <div id="register-view" class="hidden bg-surface p-8 rounded-lg shadow-sm border border-border">
                <h2 class="text-2xl font-medium mb-6 text-center">Create Account</h2>
                <form id="register-form" class="space-y-4">
                    <div>
                        <input type="text" id="register-username" placeholder="Username" required 
                               class="w-full px-4 py-2 rounded-lg border border-border bg-background focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                    </div>
                    <div>
                        <input type="password" id="register-password" placeholder="Password" required 
                               class="w-full px-4 py-2 rounded-lg border border-border bg-background focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                    </div>
                    <button type="submit" 
                            class="w-full bg-primary text-white py-2 rounded-lg hover:bg-primary/90 transition-colors">
                        Create Account
                    </button>
                </form>
                <p class="mt-4 text-sm text-center text-secondary">
                    Already have an account? 
                    <a href="#" id="show-login" class="text-primary hover:underline">Sign in</a>
                </p>
            </div>
        </div>
    </div>

    <!-- 主应用界面 -->
    <div id="app-container" class="hidden h-screen">
        <!-- 移动端导航栏 -->
        <nav class="lg:hidden fixed top-0 left-0 right-0 bg-surface border-b border-border z-30">
            <div class="flex items-center justify-between p-4">
                <div class="flex items-center space-x-3">
                    <button id="mobile-sidebar-toggle" class="text-secondary hover:text-gray-700 focus:outline-none" aria-label="Toggle Sidebar">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    <div class="flex items-center space-x-2">
                        <img src="/static/icons/logo.png" alt="Logo" class="h-8 w-8">
                        <h1 class="text-xl font-semibold text-gray-900">TaskGo</h1>
                    </div>
                </div>
                <!-- 移动端搜索栏 -->
                <div class="flex items-center space-x-2">
                    <div class="relative w-40">
                        <input type="text" id="mobile-search-input" placeholder="Search tasks..." 
                               class="w-full px-3 py-1.5 text-sm bg-background border border-border rounded-lg 
                                      focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                        <svg class="absolute right-2 top-1.5 w-4 h-4 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 侧边栏遮罩层 -->
        <div class="sidebar-overlay fixed inset-0 bg-black/50 z-40 hidden lg:hidden"></div>
        
        <!-- 侧边栏 -->
        <aside id="sidebar" class="fixed lg:sticky top-0 left-0 h-full w-64 bg-surface border-r border-border flex flex-col z-50 transform -translate-x-full lg:translate-x-0 transition-all duration-300 ease-in-out">
            <!-- 折叠按钮 -->
            <button id="sidebar-collapse-btn" class="absolute -right-3 top-4 w-6 h-6 bg-surface border border-border rounded-full text-secondary hover:text-gray-700 focus:outline-none shadow-sm hidden lg:flex items-center justify-center cursor-pointer transform transition-transform hover:scale-110 z-10">
                <svg class="sidebar-collapse-icon w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            
            <div class="p-4 border-b border-border min-h-[60px] flex items-center">
                <div id="user-profile" class="flex items-center space-x-3 cursor-pointer group">
                    <div class="relative" title="Click to expand">
                        <img src="/static/icons/avatar.png" alt="Avatar" id="user-avatar" 
                             class="w-8 h-8 rounded-full border border-border hover:ring-2 hover:ring-primary/20 transition-all">
                        <span class="absolute -bottom-1 -right-1 w-3 h-3 bg-success rounded-full border-2 border-white"></span>
                    </div>
                    <div id="user-info" class="flex-1 sidebar-full">
                        <span id="username-display" class="font-medium"></span>
                    </div>
                    <button id="desktop-sidebar-toggle" class="lg:hidden text-secondary hover:text-gray-700 focus:outline-none">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto">
                <!-- 收藏任务导航 -->
                <div class="p-4 border-b border-border">
                    <button id="favorites-nav" class="w-full flex items-center space-x-2 p-2 rounded-md hover:bg-background transition-colors text-left">
                        <svg class="w-5 h-5 text-yellow-500" fill="currentColor" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                        </svg>
                        <span class="text-sm font-medium sidebar-full">Favorites</span>
                    </button>
                </div>
                
                <!-- 标签部分 -->
                <div class="p-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <svg class="w-5 h-5 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                            </svg>
                            <h2 class="text-sm font-medium text-secondary sidebar-full">Tags</h2>
                        </div>
                        <button id="add-tag-btn" class="sidebar-full p-1 text-secondary hover:text-primary hover:bg-background rounded transition-colors" title="Add new tag">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                            </svg>
                        </button>
                    </div>
                    <ul id="tag-list" class="space-y-1 mt-2"></ul>
                </div>
            </div>
            <div class="p-4 border-t border-border sidebar-full">
                <div class="flex space-x-2">
                    <a href="#" id="settings-btn" class="text-sm text-secondary hover:text-gray-700">Settings</a>
                    <span class="text-border">|</span>
                    <a href="#" id="logout-link" class="text-sm text-secondary hover:text-gray-700">Logout</a>
                </div>
            </div>
        </aside>

        <!-- 主内容区 -->
        <div class="flex min-h-screen w-full">
            <div class="flex-1 flex flex-col bg-background lg:ml-[256px] transition-[margin] duration-300 sidebar-adjusted w-full" data-expanded-margin="lg:ml-[256px]" data-collapsed-margin="lg:ml-[64px]">
                <!-- 桌面端顶部栏 -->
                <header class="hidden lg:block bg-surface border-b border-border p-4">
                    <div class="flex items-center justify-between max-w-screen-xl mx-auto">
                        <div class="flex items-center space-x-3">
                            <img src="/static/icons/logo.png" alt="Logo" class="h-8 w-8">
                            <h1 class="text-xl font-semibold text-gray-900">TaskGo</h1>
                        </div>
                        <div class="w-72">
                            <div class="relative">
                                <input type="text" id="search-input" placeholder="Search tasks..." 
                                       class="w-full px-4 py-2 bg-background border border-border rounded-lg 
                                              focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                                <svg class="absolute right-3 top-2.5 w-5 h-5 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </header>

            <!-- 主要内容 -->
            <main class="flex-1 overflow-y-auto pt-[104px] lg:pt-0 pb-[76px] lg:pb-4 flex flex-col w-full">
                <div class="w-full max-w-screen-xl mx-auto p-4 flex-1 flex flex-col">
                    <!-- 桌面端任务输入框 -->
                    <form id="task-form" class="mb-6 hidden lg:block">
                        <div class="relative">
                            <textarea id="task-input" placeholder="#tag1 #tag2 New task..." 
                                   class="w-full px-4 py-3 bg-surface border-2 border-border rounded-lg resize-none overflow-hidden min-h-[48px] max-h-[200px]
                                          focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/30 shadow-sm"
                                   rows="1"
                                   autocomplete="off"></textarea>
                            <button type="submit" class="absolute right-3 top-2.5 text-primary hover:text-primary/90">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                            </button>
                        </div>
                        <div id="tag-autocomplete-container" class="hidden absolute mt-1 w-full bg-surface border border-border rounded-lg shadow-lg"></div>
                    </form>
                    
                    <!-- 移动端任务输入框（固定在底部） -->
                    <form id="mobile-task-form" class="fixed bottom-0 left-0 right-0 p-3 bg-surface border-t border-border shadow-lg lg:hidden z-30">
                        <div class="relative max-w-screen-xl mx-auto">
                            <textarea id="mobile-task-input" placeholder="What needs to be done?" 
                                   class="w-full px-4 py-3 bg-background border-2 border-border rounded-lg resize-none overflow-hidden min-h-[48px] max-h-[200px]
                                          focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/30 shadow-sm"
                                   rows="1"
                                   autocomplete="off"></textarea>
                            <button type="submit" class="absolute right-3 top-2.5 text-primary hover:text-primary/90">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                            </button>
                        </div>
                        <div id="mobile-tag-autocomplete-container" class="hidden absolute bottom-[64px] left-0 right-0 mx-3 bg-surface border border-border rounded-lg shadow-lg"></div>
                    </form>

                    <!-- 任务列表 -->
                    <div id="tasks-container" class="space-y-6 min-h-[calc(100vh-13rem)] flex-1">
                        <!-- 待办任务 -->
                        <section id="todo-section" class="bg-surface rounded-xl shadow-sm border border-border/50 overflow-hidden flex-1 min-h-[20rem]">
                            <div class="flex items-center justify-between p-4 border-b border-border bg-background/50">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                    </svg>
                                    <h2 class="text-lg font-medium">Tasks</h2>
                                </div>
                                <button class="task-section-header text-secondary hover:text-primary transition-colors">
                                    <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </button>
                            </div>
                            <div class="task-content">
                                <ul id="todo-list" class="min-h-[10rem] p-2"></ul>
                            </div>
                        </section>

                        <!-- 已完成任务 -->
                        <section id="completed-section" class="bg-surface rounded-xl shadow-sm border border-border/50 overflow-hidden flex-1 min-h-[20rem]">
                            <div class="flex items-center justify-between p-4 border-b border-border bg-background/50">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-5 h-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <h2 class="text-lg font-medium">Completed</h2>
                                </div>
                                <button class="task-section-header text-secondary hover:text-primary transition-colors">
                                    <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </button>
                            </div>
                            <div class="task-content">
                                <ul id="completed-list" class="p-2"></ul>
                            </div>
                            <div class="p-4 bg-background/50 border-t border-border task-content">
                                <button id="show-more-btn" class="hidden w-full py-2 text-sm text-secondary hover:text-primary focus:outline-none transition-colors">
                                    Show more
                                </button>
                            </div>
                        </section>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 标签操作菜单 -->
    <div id="tag-menu" class="hidden fixed z-50">
        <div class="bg-surface rounded-lg shadow-lg border border-border w-48 py-1">
            <button id="edit-tag-btn" class="w-full px-4 py-2 text-left text-sm hover:bg-background flex items-center space-x-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
                <span>Edit Tag</span>
            </button>
            <button id="delete-tag-btn" class="w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-background flex items-center space-x-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                <span>Delete Tag</span>
            </button>
        </div>
    </div>

    <!-- 标签编辑模态框 -->
    <div id="edit-tag-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-surface rounded-lg shadow-xl max-w-sm w-full p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-medium">Edit Tag</h2>
                <button class="close-modal-btn text-secondary hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="edit-tag-form" class="space-y-4">
                <div>
                    <input type="text" id="edit-tag-input" placeholder="Enter new tag name" required
                           class="w-full px-4 py-2 bg-background border border-border rounded-lg
                                  focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                </div>
                <div class="flex space-x-3">
                    <button type="submit"
                            class="flex-1 bg-primary text-white py-2 rounded-lg hover:bg-primary/90 transition-colors">
                        Save
                    </button>
                    <button type="button" class="close-modal-btn flex-1 bg-background border border-border text-secondary py-2 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 设置模态框 -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4">
        <div class="bg-surface rounded-lg shadow-xl max-w-md w-full">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-medium">Settings</h2>
                    <button class="close-btn text-secondary hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <!-- 头像设置 -->
                <form id="avatar-form" class="mb-6">
                    <h3 class="text-sm font-medium text-secondary mb-2">AVATAR</h3>
                    <div class="flex items-center space-x-4">
                        <img src="/static/icons/avatar.png" alt="Current avatar" class="w-16 h-16 rounded-full border border-border">
                        <div>
                            <input type="file" id="avatar-input" accept="image/*" class="hidden">
                            <button type="button" onclick="document.getElementById('avatar-input').click()"
                                    class="px-4 py-2 text-sm bg-background border border-border rounded-lg hover:bg-gray-50">
                                Choose image
                            </button>
                        </div>
                    </div>
                </form>

                <!-- 密码修改 -->
                <form id="password-form">
                    <h3 class="text-sm font-medium text-secondary mb-2">CHANGE PASSWORD</h3>
                    <div class="space-y-4">
                        <input type="password" id="current-password" placeholder="Current password" required
                               class="w-full px-4 py-2 bg-background border border-border rounded-lg
                                      focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                        <input type="password" id="new-password" placeholder="New password" required
                               class="w-full px-4 py-2 bg-background border border-border rounded-lg
                                      focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                        <button type="submit"
                                class="w-full bg-primary text-white py-2 rounded-lg hover:bg-primary/90 transition-colors">
                            Update password
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 创建新标签模态框 -->
    <div id="create-tag-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-surface rounded-lg shadow-xl max-w-sm w-full p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-medium">Create New Tag</h2>
                <button class="close-modal-btn text-secondary hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="create-tag-form" class="space-y-4">
                <div>
                    <input type="text" id="new-tag-input" placeholder="Tag name" required 
                           class="w-full px-4 py-2 rounded-lg border border-border bg-background focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                </div>
                <div class="flex space-x-2">
                    <button type="submit" 
                            class="flex-1 bg-primary text-white py-2 rounded-lg hover:bg-primary/90 transition-colors">
                        Create Tag
                    </button>
                    <button type="button" class="close-modal-btn flex-1 bg-background border border-border text-secondary py-2 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="/static/js/script.js"></script>
</body>
</html>
